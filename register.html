<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register - Music Engine</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <a href="#main-content" class="skip-link">Skip to main content</a>
    <!-- Header -->
    <header>
        <nav class="container">
            <div class="logo">Music Engine</div>
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="profile.html">Profile</a></li>
                <li><a href="services.html">Services</a></li>
                <li><a href="governance.html">Governance</a></li>
                <li><a href="about.html">About Us</a></li>
                <li><a href="#" class="btn">Login/Signup</a></li>
            </ul>
        </nav>
    </header>

    <!-- Registration Content -->
    <div class="page-content" id="main-content">
        <div class="container">
            <h2 class="section-title">Copyright Registration Form</h2>
            <div class="auto-save-status" id="autoSaveStatus">Auto-saved</div>
            <div class="form-container">
                <!-- Step Indicator -->
                <div class="step-indicator">
                    <div class="step active" id="step1">1</div>
                    <div class="step" id="step2">2</div>
                    <div class="step" id="step3">3</div>
                </div>

                <form id="registrationForm">
                    <!-- Step 1: Work Information -->
                    <div class="form-step active" id="formStep1">
                        <h3>Work Information - Step 1 of 3</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="workcode">Work Code:</label>
                                <input type="text" id="workcode" value="WRK123456" readonly>
                            </div>
                            <div class="form-group">
                                <label for="title">Title:</label>
                                <div class="tooltip">
                                    <input type="text" id="title" placeholder="Song title" required>
                                    <span class="tooltiptext">Enter the official title of your musical work</span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="catalogNo">Catalog No:</label>
                                <input type="text" id="catalogNo" placeholder="Catalog number" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="primaryArtist">Primary Artist:</label>
                                <div class="tooltip">
                                    <input type="text" id="primaryArtist" placeholder="Primary artist name" required>
                                    <span class="tooltiptext">Main performing artist or band name</span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="featuredArtist">Featured Artist:</label>
                                <input type="text" id="featuredArtist" placeholder="Featured artist (optional)">
                            </div>
                            <div class="form-group">
                                <label for="releaseType">Release Type:</label>
                                <select id="releaseType" required>
                                    <option value="">Select release type</option>
                                    <option value="single">Single</option>
                                    <option value="album">Album</option>
                                    <option value="ep">EP</option>
                                    <option value="compilation">Compilation</option>
                                    <option value="soundtrack">Soundtrack</option>
                                    <option value="remix">Remix</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="isrc">ISRC:</label>
                                <div class="tooltip">
                                    <input type="text" id="isrc" placeholder="USRC17607839" required>
                                    <span class="tooltiptext">International Standard Recording Code - unique identifier for recordings</span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="duration">Duration:</label>
                                <input type="text" id="duration" placeholder="03:45" required>
                            </div>
                            <div class="form-group">
                                <label for="releaseDate">Release Date:</label>
                                <input type="date" id="releaseDate" required>
                            </div>
                        </div>
                    </div>

                    <!-- Step 2: Session Info & Files -->
                    <div class="form-step" id="formStep2">
                        <h3>Session Info, Files & Lyrics - Step 2 of 3</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="recordingLocation">Recording Location:</label>
                                <input type="text" id="recordingLocation" placeholder="Studio name or location">
                            </div>
                            <div class="form-group">
                                <label for="key">Key:</label>
                                <input type="text" id="key" placeholder="C Major, A Minor, etc.">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="bpm">BPM:</label>
                                <input type="number" id="bpm" placeholder="120">
                            </div>
                            <div class="form-group">
                                <label for="language">Language:</label>
                                <select id="language">
                                    <option value="EN">English</option>
                                    <option value="ES">Spanish</option>
                                    <option value="FR">French</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label id="musicFileLabel">Music File:</label>
                            <input type="file" id="musicFile" accept="audio/*">
                            <div id="multipleFilesContainer" style="display: none;">
                                <p>Upload up to 20 audio files for your EP/Album/Compilation:</p>
                                <input type="file" id="musicFiles" accept="audio/*" multiple>
                                <div id="fileList"></div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="artworkFile">Artwork:</label>
                            <input type="file" id="artworkFile" accept="image/*">
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="aiGenerated"> This content contains AI-generated material
                            </label>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="containsSamples"> This content contains samples from other works
                            </label>
                        </div>
                        <div class="form-group">
                            <label for="lyrics">Lyrics:</label>
                            <textarea id="lyrics" placeholder="Enter song lyrics here..."></textarea>
                        </div>
                        
                        <!-- Production Credits -->
                        <div class="dynamic-section">
                            <div class="section-header">
                                <h4>Production Credits</h4>
                                <button type="button" class="btn" onclick="addProductionCredit()">+ Add Credit</button>
                            </div>
                            <div id="productionCreditsContainer">
                                <div class="dynamic-entry">
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label>Role:</label>
                                            <select>
                                                <option value="producer">Producer</option>
                                                <option value="mix-engineer">Mix Engineer</option>
                                                <option value="label">Label</option>
                                                <option value="production-company">Production Company</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label>Name:</label>
                                            <input type="text" placeholder="Enter name">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 3: Rights & Credits -->
                    <div class="form-step" id="formStep3">
                        <h3>Rights & Credits - Step 3 of 3</h3>
                        
                        <!-- Songwriters -->
                        <div class="dynamic-section">
                            <div class="section-header">
                                <h4>Songwriters</h4>
                                <button type="button" class="btn" onclick="addSongwriter()">+ Add</button>
                            </div>
                            <div id="songwritersContainer">
                                <div class="dynamic-entry">
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label>Role:</label>
                                            <select>
                                                <option value="composer-author">Composer/Author</option>
                                                <option value="composer">Composer</option>
                                                <option value="lyricist">Lyricist</option>
                                                <option value="arranger">Arranger</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label>Name:</label>
                                            <input type="text" placeholder="Songwriter name">
                                        </div>
                                        <div class="form-group">
                                            <label>Split %:</label>
                                            <input type="number" placeholder="50" min="0" max="100">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Publishers -->
                        <div class="dynamic-section">
                            <div class="section-header">
                                <h4>Publishers</h4>
                                <button type="button" class="btn" onclick="addPublisher()">+ Add</button>
                            </div>
                            <div id="publishersContainer">
                                <div class="dynamic-entry">
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label>Type:</label>
                                            <select>
                                                <option value="original-publisher">Original Publisher</option>
                                                <option value="sub-publisher">Sub Publisher</option>
                                                <option value="publisher">Publisher</option>
                                                <option value="administrator">Administrator</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label>Name:</label>
                                            <input type="text" placeholder="Publisher name">
                                        </div>
                                        <div class="form-group">
                                            <label>Split %:</label>
                                            <input type="number" placeholder="50" min="0" max="100">
                                        </div>
                                        <div class="form-group">
                                            <label>Territory:</label>
                                            <select>
                                                <option value="WW">Worldwide</option>
                                                <option value="US">United States</option>
                                                <option value="EU">Europe</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Navigation -->
                    <div class="form-navigation">
                        <button type="button" class="btn btn-secondary" id="prevBtn" onclick="previousStep()" style="display: none;">Previous</button>
                        <button type="button" class="btn" id="nextBtn" onclick="nextStep()">Next</button>
                        <button type="submit" class="btn" id="submitBtn" style="display: none;">Submit Registration</button>
                    </div>
                    
                    <!-- Progress Indicator -->
                    <div id="progressIndicator" style="display: none; margin-top: 1rem; text-align: center;">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                        <p id="progressText">Processing...</p>
                    </div>
                    
                    <!-- Success Message -->
                    <div id="successMessage" style="display: none; margin-top: 1rem; text-align: center; color: #28a745;">
                        <h3>‚úÖ Registration Successful!</h3>
                        <p>Your music has been registered with ID: <strong id="registrationId"></strong></p>
                        <a href="profile.html" class="btn">View Profile</a>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div></div>
                <div class="footer-copyright">
                    <p>&copy; 2024 Music Engine. Powered by Boserena Studio.</p>
                </div>
                <div class="social-media">
                    <a href="#" class="social-icon">üìò</a>
                    <a href="#" class="social-icon">üê¶</a>
                    <a href="#" class="social-icon">üì∑</a>
                    <a href="#" class="social-icon">üéµ</a>
                </div>
            </div>
            <div class="footer-links">
                <a href="privacy.html">Privacy Policy</a>
                <a href="eula.html">EULA</a>
                <a href="terms.html">Terms of Usage</a>
            </div>
        </div>
    </footer>

    <script>
        let currentStep = 1;
        let autoSaveTimer;

        // Auto-save functionality
        function initAutoSave() {
            const formInputs = document.querySelectorAll('#registrationForm input, #registrationForm select, #registrationForm textarea');
            formInputs.forEach(input => {
                input.addEventListener('input', () => {
                    clearTimeout(autoSaveTimer);
                    autoSaveTimer = setTimeout(autoSaveForm, 2000);
                });
            });
            
            // Load saved data on page load
            loadSavedData();
        }
        
        function autoSaveForm() {
            const formData = {};
            const inputs = document.querySelectorAll('#registrationForm input, #registrationForm select, #registrationForm textarea');
            
            inputs.forEach(input => {
                if (input.type === 'checkbox') {
                    formData[input.id] = input.checked;
                } else {
                    formData[input.id] = input.value;
                }
            });
            
            localStorage.setItem('musicEngineRegistration', JSON.stringify(formData));
            showAutoSaveStatus();
        }
        
        function loadSavedData() {
            const savedData = localStorage.getItem('musicEngineRegistration');
            if (savedData) {
                const formData = JSON.parse(savedData);
                Object.keys(formData).forEach(key => {
                    const input = document.getElementById(key);
                    if (input) {
                        if (input.type === 'checkbox') {
                            input.checked = formData[key];
                        } else {
                            input.value = formData[key];
                        }
                    }
                });
            }
        }
        
        function showAutoSaveStatus() {
            const status = document.getElementById('autoSaveStatus');
            status.classList.add('show');
            setTimeout(() => {
                status.classList.remove('show');
            }, 2000);
        }
        
        // Keyboard navigation
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && e.target.tagName !== 'TEXTAREA') {
                e.preventDefault();
                const nextBtn = document.getElementById('nextBtn');
                const submitBtn = document.getElementById('submitBtn');
                
                if (nextBtn.style.display !== 'none') {
                    nextStep();
                } else if (submitBtn.style.display !== 'none') {
                    document.getElementById('registrationForm').dispatchEvent(new Event('submit'));
                }
            }
            
            if (e.key === 'Escape') {
                if (currentStep > 1) {
                    previousStep();
                }
            }
        });
        
        // Initialize auto-save when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initAutoSave();
            
            // Add release type change listener
            document.getElementById('releaseType').addEventListener('change', handleReleaseTypeChange);
            
            // Add multiple files listener
            document.getElementById('musicFiles').addEventListener('change', handleMultipleFiles);
        });
        
        function handleReleaseTypeChange() {
            const releaseType = document.getElementById('releaseType').value;
            const singleFileContainer = document.getElementById('musicFile').parentElement;
            const multipleFilesContainer = document.getElementById('multipleFilesContainer');
            const musicFileLabel = document.getElementById('musicFileLabel');
            
            if (releaseType === 'ep' || releaseType === 'album' || releaseType === 'compilation') {
                // Show multiple files upload
                document.getElementById('musicFile').style.display = 'none';
                multipleFilesContainer.style.display = 'block';
                musicFileLabel.textContent = 'Music Files:';
            } else {
                // Show single file upload
                document.getElementById('musicFile').style.display = 'block';
                multipleFilesContainer.style.display = 'none';
                musicFileLabel.textContent = 'Music File:';
                // Clear multiple files if any
                document.getElementById('musicFiles').value = '';
                document.getElementById('fileList').innerHTML = '';
            }
        }
        
        function handleMultipleFiles(event) {
            const files = event.target.files;
            const fileList = document.getElementById('fileList');
            
            if (files.length > 20) {
                alert('Maximum 20 files allowed. Please select fewer files.');
                event.target.value = '';
                return;
            }
            
            fileList.innerHTML = '';
            
            if (files.length > 0) {
                const listElement = document.createElement('ul');
                listElement.style.marginTop = '10px';
                
                for (let i = 0; i < files.length; i++) {
                    const listItem = document.createElement('li');
                    listItem.textContent = `${i + 1}. ${files[i].name}`;
                    listItem.style.fontSize = '0.9rem';
                    listItem.style.color = '#667eea';
                    listElement.appendChild(listItem);
                }
                
                fileList.appendChild(listElement);
            }
        }

        function nextStep() {
            if (currentStep < 3) {
                if (validateCurrentStep()) {
                    document.getElementById(`formStep${currentStep}`).classList.remove('active');
                    document.getElementById(`step${currentStep}`).classList.add('completed');
                    document.getElementById(`step${currentStep}`).classList.remove('active');
                    
                    currentStep++;
                    
                    document.getElementById(`formStep${currentStep}`).classList.add('active');
                    document.getElementById(`step${currentStep}`).classList.add('active');
                    
                    updateButtons();
                }
            }
        }

        function validateCurrentStep() {
            let isValid = true;
            const currentStepElement = document.getElementById(`formStep${currentStep}`);
            
            // Clear previous errors
            currentStepElement.querySelectorAll('.error-message').forEach(error => error.remove());
            currentStepElement.querySelectorAll('.error').forEach(field => field.classList.remove('error'));
            
            if (currentStep === 1) {
                const requiredFields = [
                    { id: 'title', name: 'Title' },
                    { id: 'catalogNo', name: 'Catalog No' },
                    { id: 'primaryArtist', name: 'Primary Artist' },
                    { id: 'releaseType', name: 'Release Type' },
                    { id: 'isrc', name: 'ISRC' },
                    { id: 'duration', name: 'Duration' },
                    { id: 'releaseDate', name: 'Release Date' }
                ];
                
                requiredFields.forEach(field => {
                    const element = document.getElementById(field.id);
                    if (!element.value.trim()) {
                        showError(element, `${field.name} is required`);
                        isValid = false;
                    }
                });
            }
            
            return isValid;
        }
        
        function showError(field, message) {
            field.classList.add('error');
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            errorDiv.textContent = message;
            field.parentNode.appendChild(errorDiv);
        }

        function previousStep() {
            if (currentStep > 1) {
                document.getElementById(`formStep${currentStep}`).classList.remove('active');
                document.getElementById(`step${currentStep}`).classList.remove('active');
                
                currentStep--;
                
                document.getElementById(`formStep${currentStep}`).classList.add('active');
                document.getElementById(`step${currentStep}`).classList.add('completed');
                document.getElementById(`step${currentStep}`).classList.add('active');
                
                updateButtons();
            }
        }

        function updateButtons() {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const submitBtn = document.getElementById('submitBtn');

            prevBtn.style.display = currentStep > 1 ? 'inline-block' : 'none';
            nextBtn.style.display = currentStep < 3 ? 'inline-block' : 'none';
            submitBtn.style.display = currentStep === 3 ? 'inline-block' : 'none';
        }

        function addSongwriter() {
            const container = document.getElementById('songwritersContainer');
            const newEntry = document.createElement('div');
            newEntry.className = 'dynamic-entry';
            newEntry.innerHTML = `
                <button type="button" class="remove-btn" onclick="this.parentElement.remove()">Remove</button>
                <div class="form-row">
                    <div class="form-group">
                        <label>Role:</label>
                        <select>
                            <option value="composer-author">Composer/Author</option>
                            <option value="composer">Composer</option>
                            <option value="lyricist">Lyricist</option>
                            <option value="arranger">Arranger</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Name:</label>
                        <input type="text" placeholder="Songwriter name">
                    </div>
                    <div class="form-group">
                        <label>Split %:</label>
                        <input type="number" placeholder="50" min="0" max="100">
                    </div>
                </div>
            `;
            container.appendChild(newEntry);
        }

        function addPublisher() {
            const container = document.getElementById('publishersContainer');
            const newEntry = document.createElement('div');
            newEntry.className = 'dynamic-entry';
            newEntry.innerHTML = `
                <button type="button" class="remove-btn" onclick="this.parentElement.remove()">Remove</button>
                <div class="form-row">
                    <div class="form-group">
                        <label>Type:</label>
                        <select>
                            <option value="original-publisher">Original Publisher</option>
                            <option value="sub-publisher">Sub Publisher</option>
                            <option value="publisher">Publisher</option>
                            <option value="administrator">Administrator</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Name:</label>
                        <input type="text" placeholder="Publisher name">
                    </div>
                    <div class="form-group">
                        <label>Split %:</label>
                        <input type="number" placeholder="50" min="0" max="100">
                    </div>
                    <div class="form-group">
                        <label>Territory:</label>
                        <select>
                            <option value="WW">Worldwide</option>
                            <option value="US">United States</option>
                            <option value="EU">Europe</option>
                        </select>
                    </div>
                </div>
            `;
            container.appendChild(newEntry);
        }
        
        function addProductionCredit() {
            const container = document.getElementById('productionCreditsContainer');
            const newEntry = document.createElement('div');
            newEntry.className = 'dynamic-entry';
            newEntry.innerHTML = `
                <button type="button" class="remove-btn" onclick="this.parentElement.remove()">Remove</button>
                <div class="form-row">
                    <div class="form-group">
                        <label>Role:</label>
                        <select>
                            <option value="producer">Producer</option>
                            <option value="mix-engineer">Mix Engineer</option>
                            <option value="label">Label</option>
                            <option value="production-company">Production Company</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Name:</label>
                        <input type="text" placeholder="Enter name">
                    </div>
                </div>
            `;
            container.appendChild(newEntry);
        }

        document.getElementById('registrationForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Validate all required fields before submission
            if (!validateAllSteps()) {
                alert('Please fill in all required fields before submitting.');
                return;
            }
            
            // Show progress indicator
            document.getElementById('progressIndicator').style.display = 'block';
            document.getElementById('submitBtn').disabled = true;
            
            // Collect form data
            const formData = new FormData();
            
            // Step 1 data
            formData.append('title', document.getElementById('title').value);
            formData.append('primaryArtist', document.getElementById('primaryArtist').value);
            formData.append('catalogNo', document.getElementById('catalogNo').value);
            formData.append('featuredArtist', document.getElementById('featuredArtist').value);
            formData.append('isrc', document.getElementById('isrc').value);
            formData.append('duration', document.getElementById('duration').value);
            formData.append('releaseDate', document.getElementById('releaseDate').value);
            
            // Step 2 data
            formData.append('recordingLocation', document.getElementById('recordingLocation').value);
            formData.append('key', document.getElementById('key').value);
            formData.append('bpm', document.getElementById('bpm').value);
            formData.append('language', document.getElementById('language').value);
            formData.append('lyrics', document.getElementById('lyrics').value);
            formData.append('aiGenerated', document.getElementById('aiGenerated').checked);
            formData.append('containsSamples', document.getElementById('containsSamples').checked);
            
            // Files
            const releaseType = document.getElementById('releaseType').value;
            if (releaseType === 'ep' || releaseType === 'album' || releaseType === 'compilation') {
                const musicFiles = document.getElementById('musicFiles').files;
                for (let i = 0; i < musicFiles.length; i++) {
                    formData.append(`musicFile${i}`, musicFiles[i]);
                }
            } else {
                const musicFile = document.getElementById('musicFile').files[0];
                if (musicFile) formData.append('musicFile', musicFile);
            }
            
            const artworkFile = document.getElementById('artworkFile').files[0];
            if (artworkFile) formData.append('artworkFile', artworkFile);
            
            // Simulate AJAX submission with progress
            await simulateSubmission();
        });
        
        function validateAllSteps() {
            const requiredFields = [
                'title', 'catalogNo', 'primaryArtist', 'releaseType', 
                'isrc', 'duration', 'releaseDate'
            ];
            
            return requiredFields.every(fieldId => {
                const field = document.getElementById(fieldId);
                return field && field.value.trim();
            });
        }
        
        async function simulateSubmission() {
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');
            
            // Step 1: Validating data
            progressText.textContent = 'Validating submission data...';
            progressFill.style.width = '20%';
            await sleep(1000);
            
            // Step 2: Processing files
            progressText.textContent = 'Processing audio and artwork files...';
            progressFill.style.width = '50%';
            await sleep(1500);
            
            // Step 3: Generating copyright certificate
            progressText.textContent = 'Generating copyright certificate...';
            progressFill.style.width = '80%';
            await sleep(1000);
            
            // Step 4: Finalizing registration
            progressText.textContent = 'Finalizing registration...';
            progressFill.style.width = '100%';
            await sleep(800);
            
            // Show success
            document.getElementById('progressIndicator').style.display = 'none';
            document.getElementById('successMessage').style.display = 'block';
            document.getElementById('registrationId').textContent = 'ME-' + Date.now();
            
            // Clear saved data after successful submission
            localStorage.removeItem('musicEngineRegistration');
            
            // Hide form
            document.querySelector('.form-container').style.display = 'none';
        }
        
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
    </script>