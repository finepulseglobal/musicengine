<!DOCTYPE html>
<html>
<head>
    <title>Copyright Registration Form</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 1000px; margin: 0 auto; padding: 20px; }
        .form-section { margin: 30px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
        .form-group { margin: 15px 0; }
        .form-row { display: flex; gap: 15px; }
        .form-row .form-group { flex: 1; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, textarea, select { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
        button { background: #007cba; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #005a87; }
        .add-btn { background: #28a745; font-size: 18px; width: 35px; height: 35px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; }
        .remove-btn { background: #dc3545; }
        .result { margin: 20px 0; padding: 15px; background: #f0f0f0; border-radius: 4px; }
        .error { background: #ffe6e6; color: #d00; }
        .success { background: #e6ffe6; color: #060; }
        .dynamic-section { border: 1px solid #eee; padding: 15px; margin: 10px 0; border-radius: 4px; position: relative; }
        .section-header { display: flex; align-items: center; gap: 10px; margin-bottom: 15px; }
        h1 { color: #333; text-align: center; }
        h2 { color: #333; border-bottom: 2px solid #007cba; padding-bottom: 10px; }
    </style>
</head>
<body>
    <h1>Copyright Registration Form</h1>
    
    <form id="copyrightForm">
        <!-- Work Information -->
        <div class="form-section">
            <h2>Work Information</h2>
            <div class="form-row">
                <div class="form-group">
                    <label>Work Code:</label>
                    <input type="text" id="workcode" placeholder="Auto-generated">
                </div>
                <div class="form-group">
                    <label>Title:</label>
                    <input type="text" id="title" required>
                </div>
                <div class="form-group">
                    <label>Catalog No:</label>
                    <input type="text" id="catalog_no">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label>Primary Artist:</label>
                    <input type="text" id="primary_artist" required>
                </div>
                <div class="form-group">
                    <label>Featured Artist:</label>
                    <input type="text" id="featured_artist">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label>ISRC:</label>
                    <input type="text" id="isrc" placeholder="USRC17607839">
                </div>
                <div class="form-group">
                    <label>Duration (mm:ss):</label>
                    <input type="text" id="duration" placeholder="03:45">
                </div>
                <div class="form-group">
                    <label>Release Date:</label>
                    <input type="date" id="release_date">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label>Release Type:</label>
                    <select id="release_type">
                        <option value="Single">Single</option>
                        <option value="Album">Album</option>
                        <option value="EP">EP</option>
                        <option value="Compilation">Compilation</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ISWC:</label>
                    <input type="text" id="iswc" placeholder="T-123456789-0">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label>Society:</label>
                    <input type="text" id="society" placeholder="ASCAP, BMI, SESAC, etc.">
                </div>
            </div>
        </div>

        <!-- Session Info -->
        <div class="form-section">
            <h2>Session Info</h2>
            <div class="form-row">
                <div class="form-group">
                    <label>Recording Location:</label>
                    <input type="text" id="recording_location" placeholder="Studio name or location">
                </div>
                <div class="form-group">
                    <label>Key:</label>
                    <input type="text" id="key" placeholder="C Major, A Minor, etc.">
                </div>
                <div class="form-group">
                    <label>BPM:</label>
                    <input type="number" id="bpm" placeholder="120">
                </div>
                <div class="form-group">
                    <label>Tempo:</label>
                    <input type="text" id="tempo" placeholder="Moderate, Fast, Slow">
                </div>
            </div>
            
            <!-- Producers -->
            <div class="section-header">
                <h3>Producers</h3>
                <button type="button" class="add-btn" onclick="addProducer()" title="Add Producer">+</button>
            </div>
            <div id="producers-container">
                <div class="dynamic-section producer-entry">
                    <div class="form-group">
                        <label>Producer Name:</label>
                        <input type="text" class="producer-name">
                    </div>
                </div>
            </div>
            
            <!-- Studio Technicians -->
            <div class="section-header">
                <h3>Studio Technicians</h3>
                <button type="button" class="add-btn" onclick="addTechnician()" title="Add Technician">+</button>
            </div>
            <div id="technicians-container">
                <div class="dynamic-section technician-entry">
                    <div class="form-group">
                        <label>Technician Name:</label>
                        <input type="text" class="technician-name">
                    </div>
                </div>
            </div>
        </div>

        <!-- Lyrics Section -->
        <div class="form-section">
            <h2>Lyrics</h2>
            <div class="form-group">
                <label>Lyrics:</label>
                <textarea id="lyrics" rows="8" placeholder="Enter song lyrics here..."></textarea>
            </div>
        </div>

        <!-- Songwriters Section -->
        <div class="form-section">
            <div class="section-header">
                <h2>Songwriters</h2>
                <button type="button" class="add-btn" onclick="addSongwriter()" title="Add Songwriter">+</button>
            </div>
            <div id="songwriters-container">
                <div class="dynamic-section songwriter-entry">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Songwriter Name:</label>
                            <input type="text" class="songwriter-name" required>
                        </div>
                        <div class="form-group">
                            <label>Songwriter IPI:</label>
                            <input type="text" class="songwriter-ipi" placeholder="12345678901">
                        </div>
                        <div class="form-group">
                            <label>Songwriter ISNI:</label>
                            <input type="text" class="songwriter-isni" placeholder="0000000000000000">
                        </div>
                        <div class="form-group">
                            <label>Split %:</label>
                            <input type="number" class="songwriter-split" min="0" max="100" placeholder="50">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Publishers Section -->
        <div class="form-section">
            <div class="section-header">
                <h2>Publishers</h2>
                <button type="button" class="add-btn" onclick="addPublisher()" title="Add Publisher">+</button>
            </div>
            <div id="publishers-container">
                <div class="dynamic-section publisher-entry">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Publisher Name:</label>
                            <input type="text" class="publisher-name">
                        </div>
                        <div class="form-group">
                            <label>Publisher IPI:</label>
                            <input type="text" class="publisher-ipi" placeholder="12345678901">
                        </div>
                        <div class="form-group">
                            <label>Publisher ISNI:</label>
                            <input type="text" class="publisher-isni" placeholder="0000000000000000">
                        </div>
                        <div class="form-group">
                            <label>Split %:</label>
                            <input type="number" class="publisher-split" min="0" max="100" placeholder="50">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Territory:</label>
                            <select class="publisher-territory" multiple>
                                <option value="WW">Worldwide</option>
                                <option value="US">United States</option>
                                <option value="CA">Canada</option>
                                <option value="GB">United Kingdom</option>
                                <option value="DE">Germany</option>
                                <option value="FR">France</option>
                                <option value="JP">Japan</option>
                                <option value="AU">Australia</option>
                            </select>
                            <small>Hold Ctrl/Cmd to select multiple</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Administrator Section -->
        <div class="form-section">
            <div class="section-header">
                <h2>Administrator</h2>
                <button type="button" class="add-btn" onclick="addAdministrator()" title="Add Administrator">+</button>
            </div>
            <div id="administrators-container">
                <div class="dynamic-section administrator-entry">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Administrator Name:</label>
                            <input type="text" class="administrator-name">
                        </div>
                        <div class="form-group">
                            <label>Administrator IPI:</label>
                            <input type="text" class="administrator-ipi" placeholder="12345678901">
                        </div>
                        <div class="form-group">
                            <label>Administrator ISNI:</label>
                            <input type="text" class="administrator-isni" placeholder="0000000000000000">
                        </div>
                        <div class="form-group">
                            <label>Split %:</label>
                            <input type="number" class="administrator-split" min="0" max="100" placeholder="0">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Territory:</label>
                            <select class="administrator-territory" multiple>
                                <option value="WW">Worldwide</option>
                                <option value="US">United States</option>
                                <option value="CA">Canada</option>
                                <option value="GB">United Kingdom</option>
                                <option value="DE">Germany</option>
                                <option value="FR">France</option>
                                <option value="JP">Japan</option>
                                <option value="AU">Australia</option>
                            </select>
                            <small>Hold Ctrl/Cmd to select multiple</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- File Uploads -->
        <div class="form-section">
            <h2>File Uploads</h2>
            <div class="form-row">
                <div class="form-group">
                    <label>Upload Music File:</label>
                    <input type="file" id="music_file" accept="audio/*">
                </div>
                <div class="form-group">
                    <label>Upload Artwork:</label>
                    <input type="file" id="artwork_file" accept="image/*">
                </div>
            </div>
        </div>

        <button type="submit">Submit Registration</button>
    </form>
    
    <div id="result"></div>

    <script>
        let songwriterCount = 1;
        let publisherCount = 1;
        let administratorCount = 1;
        let producerCount = 1;
        let technicianCount = 1;

        function addProducer() {
            producerCount++;
            const container = document.getElementById('producers-container');
            const producerDiv = document.createElement('div');
            producerDiv.className = 'dynamic-section producer-entry';
            producerDiv.innerHTML = `
                <button type="button" class="remove-btn" onclick="removeProducer(this)" style="float: right;">Remove</button>
                <div class="form-group">
                    <label>Producer Name:</label>
                    <input type="text" class="producer-name">
                </div>
            `;
            container.appendChild(producerDiv);
        }

        function addTechnician() {
            technicianCount++;
            const container = document.getElementById('technicians-container');
            const technicianDiv = document.createElement('div');
            technicianDiv.className = 'dynamic-section technician-entry';
            technicianDiv.innerHTML = `
                <button type="button" class="remove-btn" onclick="removeTechnician(this)" style="float: right;">Remove</button>
                <div class="form-group">
                    <label>Technician Name:</label>
                    <input type="text" class="technician-name">
                </div>
            `;
            container.appendChild(technicianDiv);
        }

        function removeProducer(button) {
            button.closest('.producer-entry').remove();
        }

        function removeTechnician(button) {
            button.closest('.technician-entry').remove();
        }

        function addSongwriter() {
            songwriterCount++;
            const container = document.getElementById('songwriters-container');
            const songwriterDiv = document.createElement('div');
            songwriterDiv.className = 'dynamic-section songwriter-entry';
            songwriterDiv.innerHTML = `
                <button type="button" class="remove-btn" onclick="removeSongwriter(this)" style="float: right;">Remove</button>
                <div class="form-row">
                    <div class="form-group">
                        <label>Songwriter Name:</label>
                        <input type="text" class="songwriter-name" required>
                    </div>
                    <div class="form-group">
                        <label>Songwriter IPI:</label>
                        <input type="text" class="songwriter-ipi" placeholder="12345678901">
                    </div>
                    <div class="form-group">
                        <label>Songwriter ISNI:</label>
                        <input type="text" class="songwriter-isni" placeholder="0000000000000000">
                    </div>
                    <div class="form-group">
                        <label>Split %:</label>
                        <input type="number" class="songwriter-split" min="0" max="100" placeholder="50">
                    </div>
                </div>
            `;
            container.appendChild(songwriterDiv);
        }

        function addPublisher() {
            publisherCount++;
            const container = document.getElementById('publishers-container');
            const publisherDiv = document.createElement('div');
            publisherDiv.className = 'dynamic-section publisher-entry';
            publisherDiv.innerHTML = `
                <button type="button" class="remove-btn" onclick="removePublisher(this)" style="float: right;">Remove</button>
                <div class="form-row">
                    <div class="form-group">
                        <label>Publisher Name:</label>
                        <input type="text" class="publisher-name">
                    </div>
                    <div class="form-group">
                        <label>Publisher IPI:</label>
                        <input type="text" class="publisher-ipi" placeholder="12345678901">
                    </div>
                    <div class="form-group">
                        <label>Publisher ISNI:</label>
                        <input type="text" class="publisher-isni" placeholder="0000000000000000">
                    </div>
                    <div class="form-group">
                        <label>Split %:</label>
                        <input type="number" class="publisher-split" min="0" max="100" placeholder="50">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Territory:</label>
                        <select class="publisher-territory" multiple>
                            <option value="WW">Worldwide</option>
                            <option value="US">United States</option>
                            <option value="CA">Canada</option>
                            <option value="GB">United Kingdom</option>
                            <option value="DE">Germany</option>
                            <option value="FR">France</option>
                            <option value="JP">Japan</option>
                            <option value="AU">Australia</option>
                        </select>
                        <small>Hold Ctrl/Cmd to select multiple</small>
                    </div>
                </div>
            `;
            container.appendChild(publisherDiv);
        }

        function addAdministrator() {
            administratorCount++;
            const container = document.getElementById('administrators-container');
            const administratorDiv = document.createElement('div');
            administratorDiv.className = 'dynamic-section administrator-entry';
            administratorDiv.innerHTML = `
                <button type="button" class="remove-btn" onclick="removeAdministrator(this)" style="float: right;">Remove</button>
                <div class="form-row">
                    <div class="form-group">
                        <label>Administrator Name:</label>
                        <input type="text" class="administrator-name">
                    </div>
                    <div class="form-group">
                        <label>Administrator IPI:</label>
                        <input type="text" class="administrator-ipi" placeholder="12345678901">
                    </div>
                    <div class="form-group">
                        <label>Administrator ISNI:</label>
                        <input type="text" class="administrator-isni" placeholder="0000000000000000">
                    </div>
                    <div class="form-group">
                        <label>Split %:</label>
                        <input type="number" class="administrator-split" min="0" max="100" placeholder="0">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Territory:</label>
                        <select class="administrator-territory" multiple>
                            <option value="WW">Worldwide</option>
                            <option value="US">United States</option>
                            <option value="CA">Canada</option>
                            <option value="GB">United Kingdom</option>
                            <option value="DE">Germany</option>
                            <option value="FR">France</option>
                            <option value="JP">Japan</option>
                            <option value="AU">Australia</option>
                        </select>
                        <small>Hold Ctrl/Cmd to select multiple</small>
                    </div>
                </div>
            `;
            container.appendChild(administratorDiv);
        }

        function removeSongwriter(button) {
            button.closest('.songwriter-entry').remove();
        }

        function removePublisher(button) {
            button.closest('.publisher-entry').remove();
        }

        function removeAdministrator(button) {
            button.closest('.administrator-entry').remove();
        }

        // Generate work code
        function generateWorkCode() {
            const prefix = 'WRK';
            const timestamp = Date.now().toString().slice(-6);
            return `${prefix}${timestamp}`;
        }

        // Set work code on page load
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('workcode').value = generateWorkCode();
        });

        document.getElementById('copyrightForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // Collect songwriters
            const songwriters = [];
            document.querySelectorAll('.songwriter-entry').forEach(entry => {
                songwriters.push({
                    name: entry.querySelector('.songwriter-name').value,
                    ipi: entry.querySelector('.songwriter-ipi').value,
                    isni: entry.querySelector('.songwriter-isni').value,
                    split: entry.querySelector('.songwriter-split').value
                });
            });

            // Collect publishers
            const publishers = [];
            document.querySelectorAll('.publisher-entry').forEach(entry => {
                const territories = Array.from(entry.querySelector('.publisher-territory').selectedOptions)
                    .map(option => option.value);
                publishers.push({
                    name: entry.querySelector('.publisher-name').value,
                    ipi: entry.querySelector('.publisher-ipi').value,
                    isni: entry.querySelector('.publisher-isni').value,
                    split: entry.querySelector('.publisher-split').value,
                    territory: territories.join(', ')
                });
            });

            // Collect administrators
            const administrators = [];
            document.querySelectorAll('.administrator-entry').forEach(entry => {
                const territories = Array.from(entry.querySelector('.administrator-territory').selectedOptions)
                    .map(option => option.value);
                administrators.push({
                    name: entry.querySelector('.administrator-name').value,
                    ipi: entry.querySelector('.administrator-ipi').value,
                    isni: entry.querySelector('.administrator-isni').value,
                    split: entry.querySelector('.administrator-split').value,
                    territory: territories.join(', ')
                });
            });

            // Collect producers
            const producers = [];
            document.querySelectorAll('.producer-entry').forEach(entry => {
                producers.push({
                    name: entry.querySelector('.producer-name').value
                });
            });

            // Collect technicians
            const technicians = [];
            document.querySelectorAll('.technician-entry').forEach(entry => {
                technicians.push({
                    name: entry.querySelector('.technician-name').value
                });
            });

            const data = {
                workcode: document.getElementById('workcode').value,
                title: document.getElementById('title').value,
                catalog_no: document.getElementById('catalog_no').value,
                primary_artist: document.getElementById('primary_artist').value,
                featured_artist: document.getElementById('featured_artist').value,
                isrc: document.getElementById('isrc').value,
                duration: document.getElementById('duration').value,
                release_date: document.getElementById('release_date').value,
                release_type: document.getElementById('release_type').value,
                iswc: document.getElementById('iswc').value,
                society: document.getElementById('society').value,
                recording_location: document.getElementById('recording_location').value,
                key: document.getElementById('key').value,
                bpm: document.getElementById('bpm').value,
                tempo: document.getElementById('tempo').value,
                lyrics: document.getElementById('lyrics').value,
                songwriters: songwriters,
                publishers: publishers,
                administrators: administrators,
                producers: producers,
                technicians: technicians,
                music_file: document.getElementById('music_file').files[0]?.name || null,
                artwork_file: document.getElementById('artwork_file').files[0]?.name || null
            };
            
            try {
                const response = await fetch(`${window.location.origin}/api/test`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                showResult(result, response.ok);
                
            } catch (error) {
                showResult({ error: error.message }, false);
            }
        });
        
        function showResult(result, success) {
            const resultDiv = document.getElementById('result');
            resultDiv.className = `result ${success ? 'success' : 'error'}`;
            resultDiv.innerHTML = `<pre>${JSON.stringify(result, null, 2)}</pre>`;
        }
    </script>
</body>
</html>